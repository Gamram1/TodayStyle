<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="post">

	<select id="oneCoordiPost" parameterType="int" resultType="Post">
		SELECT 
		    coordi_no as coordiNo,
		    user_id as userId,
		    coordi_content as coordiContent,
		    gender as gender,
		    season as season,
		    temperature as temperature,
		    reg_date as postTime,
		    hashtag as hashtag,
		    del_YN as delYN,
		    profileFilePath,
		    nickname as nickName,
		    filePath
		FROM(
		SELECT C.*, CI.FILEPATH AS filePath, NICKNAME, MI.FILEPATH AS profileFilePath
		FROM COORDI C
		LEFT JOIN COORDI_IMG CI ON (C.COORDI_NO=CI.COORDI_NO)
		LEFT JOIN MEMBER M ON (M.USER_ID=C.USER_ID)
		LEFT JOIN MEMBER_IMG MI ON (M.USER_ID=MI.USER_ID)
		WHERE C.COORDI_NO=#{coordiNo} AND C.DEL_YN='N')
	</select>
	
	<select id="itemList" parameterType="int" resultType="Post">
		SELECT 
			coordi_no as coordiNo,
			item_code as categoryCode,
			brand as brand,
			item_name as categoryName
		FROM (
		SELECT I.*, ITEM_NAME FROM ITEM I
		LEFT JOIN ITEM_CATEGORY IC ON(I.ITEM_CODE=IC.ITEM_CODE))
		WHERE COORDI_NO=#{coordiNo}
	</select>
	
	<select id="cmtList" parameterType="int" resultType="Post">
		SELECT 
		    coordi_post_no as itItemNo,
		    cmt_no as cmtNo,
		    cmt_writer as cmtWriter,
		    cmt_content as cmtContent,
		    del_YN as cmtDelYN,
		    cmt_time as cmtTime,
		    nickname as nickName,
		    filepath as profileFilePath
		FROM COORDI_COMMENTS  IC
		LEFT JOIN MEMBER M ON (M.USER_ID=IC.cmt_writer)
		LEFT JOIN MEMBER_IMG MI ON (MI.USER_ID=IC.cmt_writer)
		WHERE coordi_post_no=#{coordiNo} AND del_YN='N'
	</select>
	
	<select id="countLike" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM COORDI_LIKE
		GROUP BY COORDI_NO
		HAVING COORDI_NO=#{coordiNo}
	</select>
	
	<select id="countScrap" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM COORDI_SCRAP
		GROUP BY COORDI_NO
		HAVING COORDI_NO=#{coordiNo}
	</select>




	<insert id="insertInfo" parameterType="Post">
		<selectKey keyProperty="coordiNo" resultType="int" order="BEFORE">
			select COORDI_SEQ.nextval from dual
		</selectKey>
	
	   INSERT 
		   	INTO COORDI VALUES( 
		   	#{coordiNo},
		   	#{userId},
		   	#{coordiContent},
		   	#{gender},
		   	#{season},
		   	#{temperature},
		   	SYSDATE,
		   	#{hashtag},
		   	'N'
	   	)
   </insert>
   
   	<insert id="insertPic" parameterType="Post">
	INSERT 
		INTO COORDI_IMG VALUES(
		#{coordiNo},
		#{filePath},
		#{topyn},
		#{delyn}
		)

 
   </insert>
   
   	<insert id="insertCategory" parameterType="Post">
	
      
      
   </insert>
   

  	<insert id="insertItItem">
  	
  	
  	</insert>

  	
  	
  	<insert id="deleteItItem">
  	
  	
  	</insert>


	<insert id="readCmt">
    	SELECT
    		  COORDI_POST_NO,COORDICMT_SEQ.nextval,CMT_WRITER,CMT_CONTENT,CMT_PARENT,CMT_DEPTH,CMT_SEQ,DEL_YN,SYSDATE
    	 FROM COORDI_COMMENTS
    	WHERE coordiNo = #{coordi_post}
	</insert>
	

</mapper>
